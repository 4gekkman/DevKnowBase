////==================================================////
////                                                  ////
////                       Bash                       ////
////                                                  ////
////==================================================////
////                      ////
////         Ссылки       ////
////                      ////
////======================////


  // Руководства //
  //-------------//

    # Краткое руководство по Bash programming
        http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO.html

    # Более полное руководство по Bash programming (en + ru)
        http://tldp.org/LDP/Bash-Beginners-Guide/html/
        http://rus-linux.net/nlib.php?name=/MyLDP/BOOKS/Bash-Guide-1.12-ru/bash-guide-index.html

  // Cheet sheets //
  //--------------//

    # Bourne-Again SHell and Linux CLI by Martin Bruchanov
        http://bruxy.regnet.cz/linux/bash_cheatsheet/bash_cheatsheet.pdf

    # Bash CheatSheet for UNIX Systems
        https://gist.github.com/LeCoupa/122b12050f5fb267e75f


////==================================================////
////                         ////
////        Оглавление       ////
////                         ////
////=========================////


  # А.  Bash

    А1. Вводная информация
    А2. Встроенные команды
    А3. Опции исполнения

    А4. Bash scripting: основы скриптинга и отладки
    А5. Bash scripting: среда
    А6. Bash scripting: регулярные выражения
    А7. Bash scripting: потоковый редактор GNU sed
    А8. Bash scripting: условные операции
    А9. Bash scripting: интерактивные скрипты
    А10. Bash scripting: циклы
    А11. Bash scripting: переменные, массивы, операции с ними
    А12. Bash scripting: функции
    А13. Bash scripting: сигналы

  # Б.  Рецепты и наработки

    Б1.



////==================================================////
////                         ////
////        Содержание       ////
////                         ////
////=========================////

А1. Вводная информация

  --------------------------------------
  Подоглавление:

    # Ссылки
    # Введение
    # UNIX shell

      - Интерпретирует команды пользователя
      - Команды могут быть приняты в интерактивном режиме, или в файле
      - Шелл-скрипты интерпретируются, а не компилируются
      - Шелл обеспечивает окружение
      - Bash это shell проекта GNU

    # Фичи bash

      - Расширенный набор опций исполнения
      - Startup-конфиги bash
      - Интерактивные скрипты
      - Улучшенные условные операции [[, [, test
      - Арифметика с помощью let
      - Алиасы
      - Одномерные массивы
      - История недавно песещённых каталогов
      - Управление prompt-строкой

    # Какие конфиги считывает при старте

      - Интерактивный, аутентифицированный
      - Интерактивный, не аутентифицированный
      - Не интерактивный
      - SH-режим
      - POSIX-режим
      - Remote-режим
      - Режим UID != EUID

    # Отличия поведения интерактивных от не интерактивных скриптов

      - Читает startup-файлы
      - Job-control вкл по умолчанию
      - Prompt-строки не пусты
      - Команды считываются из командной строки,
      - Не выходит после EOF
      - История команд вкл по умолчанию
      - Alias Expansion включено
      - Сигнал SIGTERM игнорируется
      - Сигнал SIGINT ловится и обрабатывается
      - При выходе отправляет SIGHUP всем задачам
      - Команды выполняются сразу после чтения
      - Bash проверяет почту периодически
      - Выход при встрече unreferenced variables выкл
      - Выход при ошибках в redirection выкл
      - Выход в POSIX-режиме built-ins returning errors выкл
      - Ошибка в exec не приведёт к выходу из шелла
      - Ошиби парсинга не приводят к выходи из шелла
      - Простая проверка орфографии для cd вкл по умолчанию
      - Авто выход после истечения времени в TMOUT вкл

    # Исполнение команд

      - 3-ри типа команд: скомпилированые / встроенные / скрипты
      - Исполнение скомпилированных команд
      - Исполнение встроенных команд
      - Исполнение команд из скрипта

    # Полная картина работы Bash в мелком масштабе

      - Bash-синтаксис
      - Bash-команды
      - Bash-функции
      - Bash-переменные
      - Bash-расширения
      - Bash-переадресация
      - Исполнение команд в Bash
      - Поиск команд в Bash
      - Bash-скрипты

  --------------------------------------

  > Ссылки

    # Вводная глава в руководстве про Bash
        http://tldp.org/LDP/Bash-Beginners-Guide/html/chap_01.html

  > Введение
    - Эта глава с краткой вводной информацией о Bash.

  > UNIX shell

    • Интерпретирует команды пользователя
    • Команды могут быть приняты в интерактивном режиме, или в файле
    • Шелл-скрипты интерпретируются, а не компилируются

      ▪ Что делает шелл
        - Шелл считывает скрипт строку за строкой.
        - В каждой строке ищет имеющиеся в системе команды.

      ▪ Что происходило бы при компиляции
        - Но не происходит, ведь шелл интерпретирует, а не компилирует.
        - Компилятор преобразовывал бы программу в машинный код.
        - В итоге получая исполняемый файл, который можно использовать в шелл-скрипте.

    • Шелл обеспечивает окружение
      - Помипо передачи скрипта ядру, у шелла есть ещё важная задача.
      - Это организация индивидуальной среды окружения.

    • Bash это shell проекта GNU
      - Это бесплатный шелл от проекта GNU для UNIX-систем.
      - Он объединяет преимущества Korn shell (ksh) и C shell (csh), включая:

        ▪ Режим редактирования в командной строке
        ▪ Неограниченный размер истории команд
        ▪ Управления задачами
        ▪ Функции и алиасы
        ▪ Неограниченные индексированные массивы
        ▪ Целочисленная арифметика по основаниями от 2 до 64

      - Bash является sh-совемстимым шеллом.
      - Он может выполнить 99% sh-скриптов без необходимости их подстроить под Bash.

  > Фичи bash

    # Расширенный набор опций исполнения
      - Список всех опций исполнения доступен здесь:
          https://www.gnu.org/software/bash/manual/html_node/Invoking-Bash.html

    # Startup-конфиги bash
      - Bash перед исполнением скрипта считывает и применяет конфиги.
      - Какие именно зависит от обстоятельств.
      - Подробности в разделе ниже.

    # Интерактивные скрипты

      • Что такое интерактивные скрипты
        - Которые читают/пишут в пользовательский терминал.
        - То есть их ввод и вывод подключены к терминалу.
        - Включить bash в интерактивном режиме можно:

          ▪ Вызвав его без аргументов-не-опций: bash
          ▪ Кроме того случае, когда опцией является строка со скриптом.
          ▪ Или когда шеллу приказано читать из STDIN

      • Как проверить, в интерактивном или нет режиме исполняется скрипт
        - Для этого надо проверить содержимое спец.параметра -
        - Проверяем:

            echo $-

        - В интерактивном режиме он выдаст: himBH
        - В неинтерактивном режиме он будет пуст.

      • Отличия в поведении интерактивных, от не интерактивных скриптов
        - Имеются некоторые отличия, подробности в разделе ниже

    # Улучшенные условные операции [[, [, test
      - Сабж.

    # Арифметика с помощью let
      - Работать с арифметиком можно командой let.
      - Это одно из дополнений, внесённых шеллом bash.

    # Алиасы

      • Работать с алиасами можно командами alias / unalias.
      • Любой алиас срабатывает только на следующей строке кода.
        - Поэтому определить и использовать алиас на 1-й строке нельзя.
      • Алиасы и функции
        - Алиасы применяются при чтении определения функции, а не когда она исполняется
        - Потому что функция считается 1-й командой.
        - Алиасы из функции будут недоступными, пока она не будет выполнена.

    # Одномерные массивы
      - Bash обеспечивает переменные - одномерные массивы.
      - Любую переменную можно использовать в качестве массива.
      - Ключевое слово declare явно определяет массив.
      - Ограничений на размер массива нет.

    # История недавно песещённых каталогов

      • pushd
        - Ключевое слово pushd добавляет каталог в историю.
        - Это происходит каждый раз при смене текущего каталога.

      • popd
        - Ключевое слово popd удаляет каталог из истории.
        - И меняет текущий каталог на извлечённых из истории.

      • dirs
        - Содержимое истории можно просмотреть ключевым словом dirs.

    # Управление prompt-строкой
      - Подробнее про управление сабжем см. в методичке по Ubuntu.
      - А также на сайте GNU: https://www.gnu.org/software/bash/manual/html_node/Controlling-the-Prompt.html

  > Какие конфиги считывает при старте

    # Интерактивный, аутентифицированный
      - Интерактивный режим, аутентифицированный пользователь / или с опцией --login
      - Интерактивный значит, что ты можешь вводить команды.
      - Аутентифицированный, значит от лица аутентифицированного пользователя.
      - Считывает следующие конфиги:

        • /etc/profile
        • ~/.bash_profile, ~/.bash_login or ~/.profile: first existing readable file is read
        • ~/.bash_logout upon logout.

    # Интерактивный, не аутентифицированный
      - Интерактивный режим, не аутентифицированный пользователь
      - Считывает следующие конфиги:

        • ~/.bashrc

    # Не интерактивный
      - Не интерактивный режим
      - Все скрипты из файлов выполняются в неинтерактивном режиме.
      - Считывает следующие конфиги:

        • defined by BASH_ENV

    # SH-режим
      - Выполняется командой sh
      - Bash старается вести себя, как sh.
      - Считывает следующие конфиги:

        • /etc/profile
        • ~/.profile

    # POSIX-режим
      - Как включить режим POSIX:

        • Встроенной командой set: set -o posix
        • Выполнив скрипт с опцией --posix

      - Тогда bash будет стараться max соблюдать стандарты POSIX.
      - Установка переменной среды POSIXLY_CORRECT, это не тоже самое.
      - Считывает следующие конфиги:

        • defined by ENV variable.

    # Remote-режим
      - Исполняемые с удалённой машины
      - Считывает следующие конфиги:

        • ~/.bashrc

    # Режим UID != EUID
      - Вызов в случае, когда UID не совпадает с EUID
      - В этом случае конфиги не читаются.

  > Отличия поведения интерактивных от не интерактивных скриптов

    # Читает startup-файлы
    # Job-control вкл по умолчанию
    # Prompt-строки не пусты
    # Команды считываются из командной строки,
      - Используя опцию readline
    # Не выходит после EOF
      - Применяя опцию шелла ignoreeof.
    # История команд вкл по умолчанию
      - И хранитя в файле по адресу $HISTFILE
      - По умолчанию это ~/.bash_history.
    # Alias Expansion включено
    # Сигнал SIGTERM игнорируется
      - В отсутствии ловушек.
    # Сигнал SIGINT ловится и обрабатывается
      - Поэтому ctrl-c не приводит к немедленному выходу.
      - А шелл запрашивает подтверждения.
    # При выходе отправляет SIGHUP всем задачам
      - Используется опция huponexit
    # Команды выполняются сразу после чтения
    # Bash проверяет почту периодически
    # Выход при встрече unreferenced variables выкл
    # Выход при ошибках в redirection выкл
    # Выход в POSIX-режиме built-ins returning errors выкл
    # Ошибка в exec не приведёт к выходу из шелла
    # Ошиби парсинга не приводят к выходи из шелла
    # Простая проверка орфографии для cd вкл по умолчанию
    # Авто выход после истечения времени в TMOUT вкл

  > Исполнение команд

    # 3-ри типа команд: скомпилированые / встроенные / скрипты
      - Bash может выполнять 3-ри типа команд:

        • Скомпилированные команды
        • Встроенные в шелл команды
        • Команды из скриптов

    # Исполнение скомпилированных команд

      • Fork
        - При исполнении такой программы Bash создаёт точную копию себя.
        - Этот дочерний процесс имеет ту же среду окружения, что и его родитель.
        - Только ID этого процесса другое.
        - Описанный выше процесс называют ветвлением/форкингом (forking).

      • Exec
        - После форка адресное пространство нового процесса перезаписывается.
        - Это происходит с помощью exec-вызова к системе.

      • Механизм Fork-and-Exec
        - Он подменяет одну команду другой, оставляя ту же среду окружения.
        - Этот механизм используется для создания всех процессов в UNIX/Linux.
        - Даже 1-ый процесс init форкается в процессе загрузки системы в
          так называемой bootstrapping-процедуре.

    # Исполнение встроенных команд

      • Встроенные команды
        - Это встроенные в сам шелл команды.
        - Они необходимы для обеспечения определённого функционала.
        - Обеспечить который извне какими-то командами и т.д. нельзя.

      • Не создаётся новый процесс
        - Если простая команда начинается с имени встроенной.

      • 3-ри типа встроенных команд

        ▪ Встроенные команды Bourne Shell

            :, ., break, cd, continue, eval, exec, exit, export,
            getopts, hash, pwd, readonly, return, set, shift,
            test, [, times, trap, umask and unset.

        ▪ Встроенные команды Bash

            alias, bind, builtin, command, declare, echo, enable,
            help, let, local, logout, printf, read, shopt, type,
            typeset, ulimit and unalias.

        ▪ Особые встроенные команды
          - При выполнении в POSIX-режиме есть определённые особенности.
          - Они касаются встроенных команд:

            ▪ Во время поиска команды, команда сначала ищется среди
              специальных встроенных команд, а затем — среди функций
              командной оболочки.

            ▪ Если специальная встроенная команда возвращает состояние
              ошибки, то в неинтерактивном режиме происходит выход из
              командной оболочки.

            ▪ Инструкции присваивания, предшествующие команде, оказывают
              эффект на среду оболочки только после завершения команды.

          - Специальные встроенные команды:

            :, ., break, continue, eval, exec, exit, export,
            readonly, return, set, shift, trap and unset.

    # Исполнение команд из скрипта

      • Построчно считывает, интерпретирует, исполняет
        - Для скриптов bash делает форк и создаёт новый дочерний процесс.
        - Этот саб-шелл считывает строки из скрипта, по одной за раз.
        - Каждая строка считывается, интерпретируется и выполняется.
        - Так, как если бы они вводились в интерактивном режиме с клавиатуры.

      • Родительский процесс ждёт
        - Сабж ждёт завершения выполнения скрипта.
        - Дочерний процесс завершается, когда в скрипте кончаются строки.
        - В интерактивном режиме, род.проц. оживает, и запрашивает новую строку.

  > Полная картина работы Bash в мелком масштабе

    # Bash-синтаксис

      • Разбивает ввод на слова и операторы
        - Шелл считывает ввод и разбивает на слова и операторы.
        - Но если ввод закомментирован, то этого не происходит.

      • Трансляция в команды
        - Затем слова/операторы транслируются в команды/конструкции.
        - Каждая из которых может вернуть в результате некий статус.
        - Который интерпретатор может интерпретировать и обработать.

      • Механизм Fork-and-Exec применяется только после:

        ▪ Bash считывает ввод из файла / строки / терминала

        ▪ Ввод разбивается на слова и операторы
          - Делает он это, следуя правилам использования кавычек.
          - Эти лексемы разделяются метасимволами.
          - Выполняется подстановка алиасов.

        ▪ Анализ и подстановка
          - Bash проводит анализ и подстановку в лексемах.

        ▪ Прочее
          - Bash выполняет различные доп.действия.
          - Разбивает лексемы на списки имён файлов / команд / аргументов.

        ▪ Перенаправление
          - Производится, если это необходимо.
          - Операторы перенаправления и их операнды удаляются из списка аргументов.

        ▪ Выполняет команды

        ▪ Ждёт, собирает статусы
          - Это не обязательно.
          - Bash может подождать, пока команды будут выполнены.
          - И собрать статусы.

    # Bash-команды

      • Простые команды
        - Простая bash-команда состоит из команды и аргументов.
        - Например:

          touch file1 file2 file3

      • Составные команды
        - Состоят из набора простых команд.
        - Которые м.б. объединены друг с другом разными путями:

          ▪ Через pipeline (вывод одной команды во ввод другой)
          ▪ Условными операторами
          ▪ Циклами
          ▪ ... Каким-либо другим образом

        - Например:

          ls | more
          gunzip file.tar.gz | tar xvf -

    # Bash-функции

      • Зачем нужны
        - Это способ сгруппировать команды для использования в будущем.
        - Вызвать все эти команды можно будет по имени функции.
        - Все сгруппированные команды будут выполнены обычным образом.

      • Дочерний процесс не создаётся
        - При вызове функции дочерний процесс не создаётся.
        - Все команды выполняются в текущем процессе шелла.

    # Bash-переменные
      - Переменные в Bash хранят значения и доступны по имени.
      - Переменная может иметь значение и от 0 и более атрибутов.
      - Создать переменную можно встроенной командой declare.
      - Удалить переменную можно встроенной командой unset.

    # Bash-расширения
      - Сабж применяется каждый раз после разбития строки на лексемы.
      - Что это за bash-расширения:

        ▪ Brace expansion                   | раскрытие фигурных скобок
        ▪ Tilde expansion                   | замена символа "тильда"
        ▪ Parameter and variable expansion  | подстановка параметров и переменных
        ▪ Command substitution              | подстановка команд
        ▪ Arithmetic expansion              | раскрытие арифметических выражений
        ▪ Word splitting                    | разбиение на отдельные слова
        ▪ Filename expansion                | подстановка имен файлов

    # Bash-переадресация
      - Перед выполнением команды её input/output может быть перенаправлен.
      - Это можно сделать с помощью спец.нотации, интерпретируемой шеллом.
      - Перенаправление также м.б. использовано для открытия/закрытия файлов.

    # Исполнение команд в Bash

      • Помечает переменные
        - Некоторые слова парсер пометил, как переменные.
        - Все эти пометки сохраняются для дальнейшего использования.

      • Выполнение bash-расширений
        - Расширения применяются для не помеченных в кач-ве переменых частей команд.

      • Выявление команды и аргументов
        - Первое оставшееся после расширений слово, это команда.
        - Остальные слова, это её аргументы.

      • Выполнение переадресаций
        - Сабж.

      • Затем происходит расширение переменных
        - Подставляются их строковые значения.
        - Если имени команды нет, то переменные изменят текущую среду командной оболочки.

    # Поиск команд в Bash
      - Важной задачей Bash является поиск команд.
      - Bash делает это следующим образом:

        • Сначала ищет функцию
          - Проветяет, содержит ли команда слэши.
          - Если нет, сначала ищет среди доступных фунций по имени.

        • Затем ищет встроенную команду

        • Ищет команду в PATH
          - Если это не функция и не встроенная команда.
          - Bash хранит весь PATH в памяти, поиск по нему быстр.

        • Исполняет команду в дочернем процессе
          - Если команда найдена или содержит слэши.
          - Шелл выполняет её в дочернем процессе.

        • Решает, что это шелл-скрипт
          - Если выполнение проваливается.
          - Потому что файл ни является исполняемым, ни каталогом.

        • Шелл ждёт окончания работы команды
          - Если она не была запущена асинхронно.
          - И получает её статус.

    # Bash-скрипты
      - Шеллу 1-ым аргументом можно передать <имя>.
      - Если без параметров -c/-s, будет создан неинтерактивный
        дочерний шелл-процесс.
      - Последний сначала искать файл <имя> в так:

        • Сначала заглянет в текущий каталог.
        • Затем посмотрит в PATH.



А2. Встроенные команды

  --------------------------------------
  Подоглавление:

    # Ссылки
    # Введение
    # Справочник по встроенным командам Bourne shell и Bash

      • Bourne shell

        - :         |
        - .         |
        - break     |
        - cd        |
        - continue  |
        - eval      |
        - exec      |
        - exit      |
        - export    |
        - getopts   |
        - hash      |
        - pwd       |
        - readonly  |
        - return    |
        - set       |
        - shift     |
        - test      |
        - [         |
        - times     |
        - trap      |
        - umask     |
        - unset     |

      • Bash

        - alias     |
        - bind      |
        - builtin   |
        - command   |
        - declare   |
        - echo      |
        - enable    |
        - help      |
        - let       |
        - local     |
        - logout    |
        - printf    |
        - read      |
        - shopt     |
        - type      |
        - typeset   |
        - ulimit    |
        - unalias   |

  --------------------------------------

  > Ссылки

    # Оф.справочник GNU по встроенным командам
        http://www.gnu.org/software/bash/manual/html_node/Bash-Builtins.html

  > Введение
    - Эта глава является справочником по встроенным командам.
    - Причём, именно встроенным командам Bourne shell и Bash.
    - Оные для POSIX-режима не рассматриваются.

  > Справочник по встроенным командам Bash

    // : //
    //---//
    // -


    // . //
    //---//
    // -


    // break //
    //-------//
    // -


    // cd //
    //----//
    // -


    // continue //
    //----------//
    // -


    // eval //
    //------//
    // -


    // exec //
    //------//
    // -


    // exit //
    //------//
    // -


    // export //
    //--------//
    // -


    // getopts //
    //---------//
    // -


    // hash //
    //------//
    // -


    // pwd //
    //-----//
    // -


    // readonly //
    //----------//
    // -


    // return //
    //--------//
    // -


    // set //
    //-----//
    // -


    // shift //
    //-------//
    // -


    // test //
    //------//
    // -


    // [ //
    //---//
    // -


    // times //
    //-------//
    // -


    // trap //
    //------//
    // -


    // umask //
    //-------//
    // -


    // unset //
    //-------//
    // -


    // alias //
    //-------//
    // -


    // bind //
    //------//
    // -


    // builtin //
    //---------//
    // -


    // command //
    //---------//
    // -


    // declare //
    //---------//
    // -


    // echo //
    //------//
    // -


    // enable //
    //--------//
    // -


    // help //
    //------//
    // -


    // let //
    //-----//
    // -


    // local //
    //-------//
    // -


    // logout //
    //--------//
    // -


    // printf //
    //--------//
    // -


    // read //
    //------//
    // -


    // shopt //
    //-------//
    // -


    // type //
    //------//
    // -


    // typeset //
    //---------//
    // -


    // ulimit //
    //--------//
    // -


    // unalias //
    //---------//
    // -


А3. Опции исполнения

  --------------------------------------
  Подоглавление:

    # Ссылки
    # Введение
    # Справочник по встроенным командам Bash

      -c                    |
      -i                    |
      -l                    |
      -r                    |
      -s                    |
      -D                    |
      -O                    |
      +O                    |
      --                    |

      --debugger            |
      --dump-po-strings     |
      --dump-strings        |
      --help                |
      --init-file filename  |
      --rcfile filename     |
      --login               |
      --noediting           |
      --noprofile           |
      --norc                |
      --posix               |
      --restricted          |
      --verbose             |
      --version             |

  --------------------------------------

  > Ссылки

    # Оф.справочник GNU по встроенным командам
        https://www.gnu.org/software/bash/manual/html_node/Invoking-Bash.html

  > Введение
    - Эта глава является справочником по опциям исполнения Bash.

  > Справочник по встроенным командам Bash

    // -c //
    //----//
    // -


    // -i //
    //----//
    // -


    // -l //
    //----//
    // -


    // -r //
    //----//
    // -


    // -s //
    //----//
    // -


    // -D //
    //----//
    // -


    // -O //
    //----//
    // -


    // +O //
    //----//
    // -


    // -- //
    //----//
    // -


    // --debugger  //
    //-------------//
    // -


    // --dump-po-strings //
    //-------------------//
    // -


    // --dump-strings //
    //----------------//
    // -


    // --help //
    //--------//
    // -


    // --init-file filename //
    //----------------------//
    // -


    // --rcfile filename //
    //-------------------//
    // -


    // --login //
    //---------//
    // -


    // --noediting //
    //-------------//
    // -


    // --noprofile //
    //-------------//
    // -


    // --norc //
    //--------//
    // -


    // --posix //
    //---------//
    // -


    // --restricted //
    //--------------//
    // -


    // --verbose //
    //-----------//
    // -


    // --version //
    //-----------//
    // -









