/* INFO
Временные таблицы и вьюхи

-> Временная таблица - отличается от обычной тем, что видна
   только мне, и живет до конца сеанса
-> Создается как CREATE TEMPORARY TABLE


-----------------------------------------------------
----------------> Просмотры (вьюхи) <----------------
-----------------------------------------------------
-> Просмотр (вьюха) - это автоматически обновляемый результат запроса,
   который сохраняется в БД также, как и обычная таблица.
-> Формируется только с помощью запроса.
-> С ней можно работать как с таблицей.
-> Данные в ней НЕ хранятся. А только ссылки.
   При любом запросе к вьюхе сервер ищет данные в реальных таблицах.
-> Если в таблице(ах) из которой(ых) создана вьюха изменятся данные,
   то во вьюхе они тоже автоматически изменятся.
-> Удаление данных из вьюхи ведет к удалению из исходной таблицы.
   Изменение данных из вьюхи ведет к изменению в исходной таблице.

-----> Для чего можно использовать вьюху? <------
1. Написали сайт, куча кода, база данных.
2. Вдруг понадобилось изменить структуру базы данных
3. Создаем новую базу данных, а в старой БД на месте таблиц
   создаем вьюхи, ссылающиеся на таблицы новой БД.
   Вуаля. В приложении код менять не надо.

-----> Вьюха НЕ БУДЕТ автоматически обновляеттся, если в ней есть: <------
- Агрегатных функций - SUM()  MIN()  MAX()  COUNT()  ...
- DISTINCT
- GROUP BY
- HAVING
- UNION или UNION ALL
- Subquery - SELECT внутри другого SELECT
- Join
- Не обновляемой вьюхи после FROM
- Subquery после WHERE которое ссылаетя на таблицу из FROM
- Вьюха ссылается только на буквенные значения
- Использование временных таблиц


*/

USE fselect;

-- создать вьюху...
CREATE VIEW myView AS
  SELECT lastname FROM teachers     -- ...как результат запроса
  WHERE lastname LIKE '%ов%';

-- подготовка учебной БД
CREATE TABLE product
(
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,    -- ID
  title VARCHAR(30) NOT NULL DEFAULT '',      -- название товара
  price FLOAT NOT NULL DEFAULT 0,             -- цена товара
  quo FLOAT NOT NULL DEFAULT 0,               -- остаток на складе
  PRIMARY KEY (id)
) COMMENT 'Таблица продукты с ценой без налогов';;
INSERT INTO product
  VALUES
  (1, 'Товар 1', 123, 200),
  (2, 'Товар 2', 150, 200),
  (3, 'Товар 3', 187, 300),
  (4, 'Товар 4', 300, 400),
  (5, 'Товар 5', 225, 500);

-- пример того, когда пригождаются вьюхи
--  вьюха с ценой продуктов с учетом налогов
CREATE VIEW productWithTax AS               -- создать вьюху
  SELECT *, price * 1.18 AS price_tax       -- по запросу, в котором столбец price умножить на 1.18
  FROM product                              -- из таблицы price
  WHERE quo > 0;                            -- только по товарам, которые есть на складе

-- удаление данных из вьюхи ведет к удалению из исходной таблицы
DELETE FROM productWithTax WHERE id = 5;
SELECT * FROM product;  -- убедиться, что строка с ID = 5 исчезла

-- удалить вьюху
DROP VIEW IF EXISTS myView;

